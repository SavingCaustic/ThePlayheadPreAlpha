<!DOCTYPE html>
<html>
<head>
    <style>
        pre {
            font-size:14px;
            line-height:1.5em;
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
		// Get the hostname and port from the current page
		const hostname = window.location.hostname;
		const port = window.location.port ? window.location.port : (window.location.protocol === 'https:' ? '443' : '80');

		// Construct the WebSocket URL (ws or wss depending on whether the site is served over HTTP or HTTPS)
		const wsProtocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
		const wsUrl = `${wsProtocol}${hostname}:${port}/ws`;


            // WebSocket initialization
            const ws = new WebSocket(wsUrl);

            // WebSocket event handlers
            ws.onopen = function() {
                console.log("WebSocket connection established.");
            };

            ws.onmessage = function(event) {
                const socketOutput = document.getElementById("socketOutput");
                const newMessage = document.createElement("div");
                newMessage.textContent = event.data;

                // Append new message to the div
                socketOutput.appendChild(newMessage);
            };

            ws.onclose = function() {
                console.log("WebSocket connection closed.");
            };

            ws.onerror = function(error) {
                console.log("WebSocket error: ", error);
            };
        });
    </script>
</head>
<body>
    <p><img src="tph.png"></p>

    <h2>Constructor queue</h2>
    <pre>
      <a href="/rpc?method=rack.mount&key=synth&value=Subreal&rack_id=0" target="if">Subreal to zero</a>
      <a href="/rpc?method=unit.synth&key=lut1_overtones&value=0.4,0.3,0.2&rack_id=0" target="if">Setup LUT0</a>
    </pre>

    <h2>Start- and shop</h2>
    <pre>
      <a href="/startup" target="if">Start devices</a>
      <a href="/test/pe/ping" target="if">PE ping</a>
      <a href="/test/pe/rackSetup" target="if">PE load synth</a>
      <a href="/shutdown" target="if">Shutdown (stops server)</a>
    </pre>

    <h2>Synth-parameters</h2>
    <pre>
      <a href="/setRackUnitParam?rack=0&unit=synth&name=pan&value=43" target="if">pan to left</a>
      <a href="/setRackUnitParam?rack=0&unit=synth&name=cutoff&value=88" target="if">set cutoff</a>
      <a href="/rack/getFakeSynthParams" target="if">gets parameters as JSON</a>
      TBA
      <a href="/rack/0/synth/patchLoad?name=default" target="if">load patch into a synth</a>
      <a href="/rack/0/synth/patchSave?new_name=false" target="if">saves parameters as a patch</a>
    </pre>

    <h2>Rack - load and save (TBA)</h2>

    <table width="90%">
        <tr>
            <td width="50%">
                <h2>JSON RPC response</h2>
                <iframe name="if" width="500" height="200"></iframe>
            </td>
            <td>
                <h2>WEB Socket output</h2>
                <div id="socketOutput" style="width:500px;height:200px;border:1px solid #000;overflow-y: scroll;"></div>
            </td>
        </tr>
    </table>
</body>
</html>
